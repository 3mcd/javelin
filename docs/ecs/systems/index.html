<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <title>Javelin Docs</title>

      <!-- CSS -->
      
      <link rel="preconnect" href="https://fonts.gstatic.com">
      <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
      <link rel="stylesheet" href="https://javelin.games/book.css">
      

      
      
    </head>

    <body>
        <header>
          <section>
            <nav>
              <a class="fat" href="/introduction"><h1>Javelin</h1></a>
              <a class="version" href="https:&#x2F;&#x2F;github.com&#x2F;3mcd&#x2F;javelin/releases/tag/v1.0.0">v1.0.0</a>
            </nav>
            <nav>
              <a class="fat disabled" href="#">API Docs</a>
              <a class="fat" href="https:&#x2F;&#x2F;github.com&#x2F;3mcd&#x2F;javelin">GitHub</a>
            </nav>
          </section>
        </header>
        <main>
          <section>
            <div class="menu">
                
                
                <nav role="navigation">
                    <ul>
                        
                            
                            
                                
                                <li >
                                    
                                    <a href="https:&#x2F;&#x2F;javelin.games&#x2F;introduction&#x2F;">
                                        <span>1. </span>
                                        <strong>Introduction</strong>
                                    </a>
                                    
                                </li>
                            
                                
                                <li >
                                    
                                    <a href="https:&#x2F;&#x2F;javelin.games&#x2F;ecs&#x2F;">
                                        <span>2. </span>
                                        <strong>ECS</strong>
                                    </a>
                                    
                                        <ul>
                                            
                                                <li >
                                                    <a href="https:&#x2F;&#x2F;javelin.games&#x2F;ecs&#x2F;world&#x2F;">
                                                        
                                                        World
                                                    </a>
                                                </li>
                                            
                                                <li >
                                                    <a href="https:&#x2F;&#x2F;javelin.games&#x2F;ecs&#x2F;components&#x2F;">
                                                        
                                                        Components
                                                    </a>
                                                </li>
                                            
                                                <li >
                                                    <a href="https:&#x2F;&#x2F;javelin.games&#x2F;ecs&#x2F;entities&#x2F;">
                                                        
                                                        Entities
                                                    </a>
                                                </li>
                                            
                                                <li class="active">
                                                    <a href="https:&#x2F;&#x2F;javelin.games&#x2F;ecs&#x2F;systems&#x2F;">
                                                        
                                                        Systems
                                                    </a>
                                                </li>
                                            
                                                <li >
                                                    <a href="https:&#x2F;&#x2F;javelin.games&#x2F;ecs&#x2F;effects&#x2F;">
                                                        
                                                        Effects
                                                    </a>
                                                </li>
                                            
                                                <li >
                                                    <a href="https:&#x2F;&#x2F;javelin.games&#x2F;ecs&#x2F;events&#x2F;">
                                                        
                                                        Events
                                                    </a>
                                                </li>
                                            
                                                <li >
                                                    <a href="https:&#x2F;&#x2F;javelin.games&#x2F;ecs&#x2F;topics&#x2F;">
                                                        
                                                        Topics
                                                    </a>
                                                </li>
                                            
                                                <li >
                                                    <a href="https:&#x2F;&#x2F;javelin.games&#x2F;ecs&#x2F;change-detection&#x2F;">
                                                        
                                                        Change Detection
                                                    </a>
                                                </li>
                                            
                                                <li >
                                                    <a href="https:&#x2F;&#x2F;javelin.games&#x2F;ecs&#x2F;performance&#x2F;">
                                                        
                                                        Performance
                                                    </a>
                                                </li>
                                            
                                        </ul>
                                    
                                </li>
                            
                                
                                <li >
                                    
                                    <a href="https:&#x2F;&#x2F;javelin.games&#x2F;networking&#x2F;">
                                        <span>3. </span>
                                        <strong>Networking</strong>
                                    </a>
                                    
                                </li>
                            
                                
                                <li >
                                    
                                    <a href="https:&#x2F;&#x2F;javelin.games&#x2F;resources&#x2F;">
                                        <span>4. </span>
                                        <strong>Resources</strong>
                                    </a>
                                    
                                </li>
                            
                        
                    </ul>
                </nav>
                
                
            </div>

            <div class="page">
                <div class="page__content">
                    
                    <div class="search-container">
                        <input id="search" type="search" placeholder="Search..">
                        <div class="search-results">
                            <div class="search-results__header"></div>
                            <ul class="search-results__items"></ul>
                        </div>
                    </div>
                    
                    <div class="book-content">
                        
<h1>Systems</h1>
<p>A <strong>system</strong> is simply a function executed during each world step. All game logic should live within systems.</p>
<h2 id="game-logic">Game Logic<a class="zola-anchor" href="#game-logic" aria-label="Anchor link for: game-logic"
  >#</a
>
</h2>
<p>Each system should implement some subset of your game's logic. Ideally a system manages a small number of concerns. There is minimal performance overhead to having multiple small systems versus monolithic ones, and smaller systems are easier to read, test, and maintain.</p>
<p>Below is an example set of systems that could be found in a top-down ARPG.</p>
<table><thead><tr><th>System</th><th>Description</th></tr></thead><tbody>
<tr><td><code>enemyAI</code></td><td>Enemy AI logic</td></tr>
<tr><td><code>companionAI</code></td><td>Companion AI logic</td></tr>
<tr><td><code>input</code></td><td>Sample mouse/keyboard input</td></tr>
<tr><td><code>combat</code></td><td>Transform controller input to combat actions</td></tr>
<tr><td><code>movement</code></td><td>Transform controller input to movement actions</td></tr>
<tr><td><code>physics</code></td><td>Apply forces and step physics simulation</td></tr>
<tr><td><code>pickups</code></td><td>Detect collisions with items and update player inventory</td></tr>
<tr><td><code>render</code></td><td>Render game</td></tr>
<tr><td><code>renderUI</code></td><td>Render user interface</td></tr>
<tr><td>...</td><td></td></tr>
</tbody></table>
<h3 id="registering-a-system">Registering a System<a class="zola-anchor" href="#registering-a-system" aria-label="Anchor link for: registering-a-system"
  >#</a
>
</h3>
<p>A system is a void function that accepts a <code>World</code> instance as its only parameter:</p>
<pre data-lang="ts" class="language-ts "><code class="language-ts" data-lang="ts">const enemyAI = (world: World) =&gt; {}
</code></pre>
<p>Systems are registered with the world via the options passed to <code>createWorld</code>, or the <code>world.addSystem</code> method.</p>
<pre data-lang="ts" class="language-ts "><code class="language-ts" data-lang="ts">const physics = () =&gt; ...
const render = () =&gt; ...
const world = createWorld({ systems: [physics] })

world.addSystem(render)
</code></pre>
<p>Systems have a signature of <code>(world: World) =&gt; void</code>, where the only argument is the world that's currently mid-step. The <code>world.step()</code> method executes systems in the same order in which they were registered.</p>
<p><code>world.step</code> accepts a single argument, <code>tickData</code>, which will be assigned to <code>world.latestTickData</code> at the beginning of each step. To demonstrate, the following is a world that logs the time elapsed since the last step, 60 times per second:</p>
<pre data-lang="ts" class="language-ts "><code class="language-ts" data-lang="ts">const world = createWorld&lt;number&gt;()
world.addSystem(world =&gt; console.log(world.latestTickData))

let t1: number

setInterval(() =&gt; {
  const t2 = performance.now()
  world.step(t2 - (t1 ?? t2))
  t1 = t2
}, (1 &#x2F; 60) * 1000)
</code></pre>
<pre><code>&gt; 16.66666666
&gt; 16.66666666
&gt; 16.66666666
</code></pre>
<h2 id="querying-and-iteration">Querying and Iteration<a class="zola-anchor" href="#querying-and-iteration" aria-label="Anchor link for: querying-and-iteration"
  >#</a
>
</h2>
<p>Systems query iterable lists of entities and modify them to produce the next game state. These lists are called <strong>queries</strong>.</p>
<p>Depending on its component makeup, an entity may be eligible for iteration by a system during one step, and ineligible the next. Querying is the cornerstone of ECS: changes to entity-component composition implicitly changes game behavior. In addition, the isolation of game logic into systems makes your game world easier to debug and provides a clear target for performance and unit tests.</p>
<p>Queries are created with the <code>createQuery</code> function, which accepts one or more schemas. This list of schemas is called a <strong>selector</strong>.</p>
<pre data-lang="ts" class="language-ts "><code class="language-ts" data-lang="ts">import { createQuery } from &quot;@javelin&#x2F;ecs&quot;

const bodies = createQuery(Position, Velocity)
</code></pre>
<p>There are two ways to iterate a query. The first (and fastest) way is to iterate the query directly with a <code>for..of</code> loop:</p>
<pre data-lang="ts" class="language-ts "><code class="language-ts" data-lang="ts">const physics = () =&gt; {
  for (const [entities, [positions, velocities]] of bodies) {
    for (let i = 0; i &lt; entities.length; i++) {
      positions[i].x += velocities[i].x
      positions[i].y += velocities[i].y
    }
  }
}
</code></pre>
<p>Although fast, this method of iteration leaks the implementation details of how components are stored in archetypes. An outer <code>for..of</code> loop iterates through each matching archetype, while an inner loop accesses components for each matching entity. If your game doesn't reach extremely high entity counts and you don't mind a 5x iteration performance hit, consider using the function form of a query:</p>
<pre data-lang="ts" class="language-ts "><code class="language-ts" data-lang="ts">const physics = () =&gt;
  bodies((entity, [position, velocity]) =&gt; {
    position.x += velocity.x
    position.y += velocity.y
  })
</code></pre>
<aside>
  <p>
    <strong>Tip</strong> — most examples in the Javelin docs iterate queries using <code>query(iteratee)</code> syntax since it's a bit easier to read, but stick to the <code>for..of</code> approach if your game world holds many entities.
  </p>
</aside>
<h3 id="binding-queries">Binding Queries<a class="zola-anchor" href="#binding-queries" aria-label="Anchor link for: binding-queries"
  >#</a
>
</h3>
<p>By default, queries will resolve entities and components of the world that is currently mid-step. If you need to run a query against a specific world (i.e., outside of a system), you can bind a query to a specific world using the <code>bind</code> method:</p>
<pre data-lang="ts" class="language-ts "><code class="language-ts" data-lang="ts">&#x2F;&#x2F; Always executes against `world`
bodies.bind(world)(entity =&gt; {})
</code></pre>
<p>You can use a query's <code>test</code> method to check if an entity would match that query.</p>
<pre data-lang="ts" class="language-ts "><code class="language-ts" data-lang="ts">world.attachImmediate(entity, [component(Position), component(Velocity)])
bodies.test(entity) &#x2F;&#x2F; -&gt; true
</code></pre>
<h3 id="result-ordering">Result Ordering<a class="zola-anchor" href="#result-ordering" aria-label="Anchor link for: result-ordering"
  >#</a
>
</h3>
<p>The order of component types in a query's selector will match the order of components in the query's results. That is, <code>createQuery(Position, Player)</code> always yields tuples of <code>(Position, Player)</code>:</p>
<pre data-lang="ts" class="language-ts "><code class="language-ts" data-lang="ts">world.create(component(Player), component(Position))
world.create(component(Position), component(Player))

const render = () =&gt;
  players((entity, [position, player]) =&gt; {
    &#x2F;&#x2F; render each player with a name tag
    drawSprite(sprites.player, position)
    drawText(player.name, position)
  })
</code></pre>
<h3 id="query-caveats">Query Caveats<a class="zola-anchor" href="#query-caveats" aria-label="Anchor link for: query-caveats"
  >#</a
>
</h3>
<p>The tuple of components yielded by queries is re-used each iteration. This means that you shouldn't store the results of a query for use later like this:</p>
<pre data-lang="ts" class="language-ts "><code class="language-ts" data-lang="ts">const results = []
shocked((entity, components) =&gt; results.push(components))
</code></pre>
<p>Every index of <code>results</code> references the same array, which is the tuple of components attached to the entity of the last iteration. If you absolutely need to store components between queries (e.g. you're optimizing a nested query), you could push the components of interest into a temporary array, e.g.</p>
<pre data-lang="ts" class="language-ts "><code class="language-ts" data-lang="ts">const results = []
shocked((entity, [a, b]) =&gt; results.push([a, b]))
</code></pre>
 
                    </div>
                </div>
            </div>
          </section>
        </main>


        
        
    </body>

</html>
