<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <title>Javelin Docs</title>

      
      

      <!-- CSS -->
      
      <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,300;0,400;0,600;1,400&display=swap" rel="stylesheet">
      <link rel="stylesheet" href="https://javelin.games/book.css">
      

      
      
    </head>

    <body>
        <main>
            <div class="menu">
                <h1>Javelin</h1>
                
                
                <nav role="navigation">
                    <ul>
                        
                            
                            
                                
                                <li >
                                    
                                    <a href="https:&#x2F;&#x2F;javelin.games&#x2F;introduction&#x2F;">
                                        
                                        Introduction
                                    </a>
                                    
                                </li>
                            
                                
                                <li >
                                    
                                    <a href="https:&#x2F;&#x2F;javelin.games&#x2F;ecs&#x2F;">
                                        
                                        ECS
                                    </a>
                                    
                                        <ul>
                                            
                                                <li >
                                                    <a href="https:&#x2F;&#x2F;javelin.games&#x2F;ecs&#x2F;installation&#x2F;">
                                                        
                                                        Installation
                                                    </a>
                                                </li>
                                            
                                                <li >
                                                    <a href="https:&#x2F;&#x2F;javelin.games&#x2F;ecs&#x2F;world&#x2F;">
                                                        
                                                        Hello World
                                                    </a>
                                                </li>
                                            
                                                <li >
                                                    <a href="https:&#x2F;&#x2F;javelin.games&#x2F;ecs&#x2F;entities&#x2F;">
                                                        
                                                        Entities
                                                    </a>
                                                </li>
                                            
                                                <li >
                                                    <a href="https:&#x2F;&#x2F;javelin.games&#x2F;ecs&#x2F;components&#x2F;">
                                                        
                                                        Components
                                                    </a>
                                                </li>
                                            
                                                <li class="active">
                                                    <a href="https:&#x2F;&#x2F;javelin.games&#x2F;ecs&#x2F;systems&#x2F;">
                                                        
                                                        Systems
                                                    </a>
                                                </li>
                                            
                                                <li >
                                                    <a href="https:&#x2F;&#x2F;javelin.games&#x2F;ecs&#x2F;filtering&#x2F;">
                                                        
                                                        Filtering
                                                    </a>
                                                </li>
                                            
                                                <li >
                                                    <a href="https:&#x2F;&#x2F;javelin.games&#x2F;ecs&#x2F;tagging&#x2F;">
                                                        
                                                        Tagging
                                                    </a>
                                                </li>
                                            
                                                <li >
                                                    <a href="https:&#x2F;&#x2F;javelin.games&#x2F;ecs&#x2F;topics&#x2F;">
                                                        
                                                        Topics
                                                    </a>
                                                </li>
                                            
                                                <li >
                                                    <a href="https:&#x2F;&#x2F;javelin.games&#x2F;ecs&#x2F;performance&#x2F;">
                                                        
                                                        Performance
                                                    </a>
                                                </li>
                                            
                                        </ul>
                                    
                                </li>
                            
                                
                                <li >
                                    
                                    <a href="https:&#x2F;&#x2F;javelin.games&#x2F;networking&#x2F;">
                                        
                                        Networking
                                    </a>
                                    
                                </li>
                            
                                
                                <li >
                                    
                                    <a href="https:&#x2F;&#x2F;javelin.games&#x2F;devtools&#x2F;">
                                        
                                        Devtools
                                    </a>
                                    
                                </li>
                            
                                
                                <li >
                                    
                                    <a href="https:&#x2F;&#x2F;javelin.games&#x2F;examples&#x2F;">
                                        
                                        Examples
                                    </a>
                                    
                                </li>
                            
                        
                    </ul>
                </nav>
                
                
            </div>

            <div class="page">
                <div class="page__content">
                    
                    <div class="search-container">
                        <input id="search" type="search" placeholder="Search..">
                        <div class="search-results">
                            <div class="search-results__header"></div>
                            <ul class="search-results__items"></ul>
                        </div>
                    </div>
                    
                    <div class="book-content">
                        
<h1>Systems</h1>
<h2 id="implementing-behavior">Implementing Behavior<a class="zola-anchor" href="#implementing-behavior" aria-label="Anchor link for: implementing-behavior"
  >#</a
>
</h2>
<p>A system is a function executed during each world tick. All game logic should live within systems. Systems operate on dynamically growing and shrinking sets of entities that are queried by their archetype (or sub-archetype). This means that, depending on its archetype, an entity may be eligible for iteration by a system one tick, and ineligible the next.</p>
<p>This is the cornerstone of ECS that enables runtime composition. Adding and removing components also adds and removes behavior. In addition, the isolation of game logic into systems makes your game world easier to debug and provides a clear target for performance and unit tests.</p>
<h3 id="registering-a-system">Registering a system<a class="zola-anchor" href="#registering-a-system" aria-label="Anchor link for: registering-a-system"
  >#</a
>
</h3>
<p>Systems are registered with the world via the options passed to <code>createWorld</code>, or the <code>world.addSystem</code> method.</p>
<pre style="background-color:#f6f8f8;">
<code><span style="color:#388282;">const </span><span style="color:#555c64;">hello </span><span style="color:#388282;">= </span><span style="color:#555c64;">() </span><span style="color:#388282;">=&gt; </span><span style="color:#88669e;">console</span><span style="color:#555c64;">.log(</span><span style="color:#4179ad;">&quot;hello&quot;</span><span style="color:#555c64;">)
</span><span style="color:#388282;">const </span><span style="color:#555c64;">world </span><span style="color:#388282;">= </span><span style="color:#555c64;">createWorld({ systems: [hello] })
</span><span style="color:#8c95a0;">// OR
</span><span style="color:#555c64;">world.addSystem(hello)
</span></code></pre>
<p>Systems have a signature of <code>(world: World&lt;T&gt;, data: T) =&gt; void</code>, where <code>world</code> is the world that is currently executing it, and <code>data</code> is the single argument (if any) passed into the tick method, i.e. <code>world.tick(data)</code>.</p>
<p>When <code>world.tick</code> is called, each system is executed in the order that it was registered. Often times <code>data</code> contains the amount of time that has elapsed since the previous tick, but it can be any value.</p>
<p>The following is an example of a &quot;game&quot; that will log the time elapsed since the last tick at around 60Hz.</p>
<pre style="background-color:#f6f8f8;">
<code><span style="color:#388282;">const </span><span style="color:#555c64;">world </span><span style="color:#388282;">= </span><span style="color:#555c64;">createWorld()
world.addSystem(</span><span style="color:#88669e;">console</span><span style="color:#555c64;">.log)

</span><span style="color:#388282;">let </span><span style="color:#555c64;">previousTime </span><span style="color:#388282;">= </span><span style="color:#88669e;">Date</span><span style="color:#555c64;">.now()

setInterval(() </span><span style="color:#388282;">=&gt; </span><span style="color:#555c64;">{
  </span><span style="color:#388282;">const </span><span style="color:#555c64;">currentTime </span><span style="color:#388282;">= </span><span style="color:#88669e;">Date</span><span style="color:#555c64;">.now()
  world.tick(currentTime </span><span style="color:#388282;">- </span><span style="color:#555c64;">previousTime)
  previousTime </span><span style="color:#388282;">= </span><span style="color:#555c64;">currentTime
}, </span><span style="color:#4179ad;">1000 </span><span style="color:#388282;">/ </span><span style="color:#4179ad;">60</span><span style="color:#555c64;">)
</span></code></pre>
<p>The output of the above program might look something like:</p>
<pre style="background-color:#f6f8f8;">
<code><span style="color:#555c64;">World { }, 16.66666666
World { }, 16.66666666
World { }, 16.66666666
</span></code></pre>
<p><strong>Note</strong> — maintaining state using <code>data</code> is an antipattern since it is injected from outside of your game world. Consider moving this state into a singleton component. Or, if you need inter-system communication, you can pass messages using topics, which are discussed in the <a href="/ecs/topics">Topics</a> chapter.</p>
<h2 id="querying-and-iteration">Querying and Iteration<a class="zola-anchor" href="#querying-and-iteration" aria-label="Anchor link for: querying-and-iteration"
  >#</a
>
</h2>
<p>Systems may execute <strong>queries</strong> to access entities and their components. Queries are created with the <code>query</code> function, which takes a <strong>selector</strong> of component types.</p>
<pre style="background-color:#f6f8f8;">
<code><span style="color:#388282;">import </span><span style="color:#555c64;">{ query, select } </span><span style="color:#388282;">from </span><span style="color:#4179ad;">&quot;@javelin/ecs&quot;

</span><span style="color:#388282;">const </span><span style="color:#555c64;">players </span><span style="color:#388282;">= </span><span style="color:#555c64;">query(select(</span><span style="color:#88669e;">Position</span><span style="color:#555c64;">, Player))
</span></code></pre>
<p>The <code>query</code> function returns a function that is then executed with a world. This function returns an iterator that yields tuples of components that belong to entities that meet the selector's criteria. The order of the components in the results match the order of components types in the selector. That is, the selector <code>select(Position, Player)</code>, will return a tuple of components <code>(Position, Player)</code>, regardless of the order in which the components are stored.</p>
<pre style="background-color:#f6f8f8;">
<code><span style="color:#388282;">const </span><span style="color:#555c64;">render </span><span style="color:#388282;">= </span><span style="color:#555c64;">(</span><span style="color:#8a6c3c;">world</span><span style="color:#388282;">: </span><span style="color:#555c64;">World, </span><span style="color:#8a6c3c;">dt</span><span style="color:#388282;">: </span><span style="color:#88669e;">number</span><span style="color:#555c64;">) </span><span style="color:#388282;">=&gt; </span><span style="color:#555c64;">{
  </span><span style="color:#388282;">for </span><span style="color:#555c64;">(</span><span style="color:#388282;">const </span><span style="color:#555c64;">[position, player] </span><span style="color:#388282;">of </span><span style="color:#555c64;">players(world)) {
    </span><span style="color:#8c95a0;">// render each player with a name tag
    </span><span style="color:#555c64;">draw(position, player.name, dt)
  }
}
</span></code></pre><h3 id="query-caveats">Query caveats<a class="zola-anchor" href="#query-caveats" aria-label="Anchor link for: query-caveats"
  >#</a
>
</h3>
<p>The tuple of components yielded by queries is re-used each iteration. This means that you can't store the results of a query for use later like this:</p>
<pre style="background-color:#f6f8f8;">
<code><span style="color:#388282;">const </span><span style="color:#555c64;">results </span><span style="color:#388282;">= </span><span style="color:#555c64;">[]

</span><span style="color:#388282;">for </span><span style="color:#555c64;">(</span><span style="color:#388282;">const </span><span style="color:#555c64;">s </span><span style="color:#388282;">of </span><span style="color:#555c64;">shocked(world)) {
  results.push(s)
}
</span></code></pre>
<p>Every index of <code>results</code> corresponds to the same array!</p>
<p>The same applies to <code>Array.from()</code>, or any other method that expands an iterator into another container. If you <em>do</em> need to store components between queries (e.g. you are optimizing a nested query), you could push the components of interest into a temporary array, e.g.</p>
<pre style="background-color:#f6f8f8;">
<code><span style="color:#388282;">const </span><span style="color:#555c64;">applyStatusEffects </span><span style="color:#388282;">= </span><span style="color:#555c64;">(</span><span style="color:#8a6c3c;">dt</span><span style="color:#388282;">: </span><span style="color:#88669e;">number</span><span style="color:#555c64;">, </span><span style="color:#8a6c3c;">world</span><span style="color:#388282;">: </span><span style="color:#555c64;">World) </span><span style="color:#388282;">=&gt; </span><span style="color:#555c64;">{
  </span><span style="color:#388282;">const </span><span style="color:#555c64;">shockedEnemies </span><span style="color:#388282;">= </span><span style="color:#555c64;">[]

  </span><span style="color:#388282;">for </span><span style="color:#555c64;">(</span><span style="color:#388282;">const </span><span style="color:#555c64;">[enemy] </span><span style="color:#388282;">of </span><span style="color:#555c64;">shocked(world)) {
    shockedEnemies.push(enemy)
  }
}
</span></code></pre> 
                    </div>
                </div>

                <div class="prev-link">
                    
                    
                </div>

                <div class="next-link">
                    
                    
                </div>
            </div>
        </main>

        
        
    </body>

</html>
