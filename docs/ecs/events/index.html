<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />

    <!-- Enable responsiveness on mobile devices-->
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1"
    />

    <title>Javelin Docs</title>

    <script src="/javelin-ecs.bundle.min.js" type="text/javascript"></script>

    <!-- CSS -->

    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,400;0,700;1,400&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="https://javelin.games/book.css" />
  </head>

  <body>
    <header>
      <section>
        <nav>
          <a class="fat" href="/introduction"><h1>Javelin</h1></a>
          <a
            class="version"
            href="https:&#x2F;&#x2F;github.com&#x2F;3mcd&#x2F;javelin/releases/tag/v0.21.0"
            >v0.21.0</a
          >
        </nav>
        <nav>
          <a class="fat disabled" href="#">API Docs</a>
          <a
            class="fat"
            href="https:&#x2F;&#x2F;github.com&#x2F;3mcd&#x2F;javelin"
            >GitHub</a
          >
        </nav>
      </section>
    </header>
    <main>
      <section>
        <div class="menu">
          <nav role="navigation">
            <ul>
              <li>
                <a
                  href="https:&#x2F;&#x2F;javelin.games&#x2F;introduction&#x2F;"
                >
                  <span>1. </span>
                  <strong>Introduction</strong>
                </a>
              </li>

              <li>
                <a href="https:&#x2F;&#x2F;javelin.games&#x2F;ecs&#x2F;">
                  <span>2. </span>
                  <strong>ECS</strong>
                </a>

                <ul>
                  <li>
                    <a
                      href="https:&#x2F;&#x2F;javelin.games&#x2F;ecs&#x2F;world&#x2F;"
                    >
                      World
                    </a>
                  </li>

                  <li>
                    <a
                      href="https:&#x2F;&#x2F;javelin.games&#x2F;ecs&#x2F;components&#x2F;"
                    >
                      Components
                    </a>
                  </li>

                  <li>
                    <a
                      href="https:&#x2F;&#x2F;javelin.games&#x2F;ecs&#x2F;entities&#x2F;"
                    >
                      Entities
                    </a>
                  </li>

                  <li>
                    <a
                      href="https:&#x2F;&#x2F;javelin.games&#x2F;ecs&#x2F;systems&#x2F;"
                    >
                      Systems
                    </a>
                  </li>

                  <li>
                    <a
                      href="https:&#x2F;&#x2F;javelin.games&#x2F;ecs&#x2F;effects&#x2F;"
                    >
                      Effects
                    </a>
                  </li>

                  <li class="active">
                    <a
                      href="https:&#x2F;&#x2F;javelin.games&#x2F;ecs&#x2F;events&#x2F;"
                    >
                      Events
                    </a>
                  </li>

                  <li>
                    <a
                      href="https:&#x2F;&#x2F;javelin.games&#x2F;ecs&#x2F;topics&#x2F;"
                    >
                      Topics
                    </a>
                  </li>

                  <li>
                    <a
                      href="https:&#x2F;&#x2F;javelin.games&#x2F;ecs&#x2F;change-detection&#x2F;"
                    >
                      Change Detection
                    </a>
                  </li>

                  <li>
                    <a
                      href="https:&#x2F;&#x2F;javelin.games&#x2F;ecs&#x2F;performance&#x2F;"
                    >
                      Performance
                    </a>
                  </li>
                </ul>
              </li>

              <li>
                <a href="https:&#x2F;&#x2F;javelin.games&#x2F;networking&#x2F;">
                  <span>3. </span>
                  <strong>Networking</strong>
                </a>
              </li>

              <li>
                <a href="https:&#x2F;&#x2F;javelin.games&#x2F;resources&#x2F;">
                  <span>4. </span>
                  <strong>Resources</strong>
                </a>
              </li>
            </ul>
          </nav>
        </div>

        <div class="page">
          <div class="page__content">
            <div class="search-container">
              <input id="search" type="search" placeholder="Search.." />
              <div class="search-results">
                <div class="search-results__header"></div>
                <ul class="search-results__items"></ul>
              </div>
            </div>

            <div class="book-content">
              <h1>Events</h1>
              <p>
                You'll eventually need to detect when components are added,
                removed, or modified. For example, you may want to know when a
                component is attached to, or detached from, an entity in order
                to trigger a change in the ECS or notify a third-party library.
                You can use some of Javelin's built-in effects and methods to
                react to these kinds of events.
              </p>
              <h2 id="signals">
                Signals<a
                  class="zola-anchor"
                  href="#signals"
                  aria-label="Anchor link for: signals"
                  >#</a
                >
              </h2>
              <p>
                A world dispatches several events, called
                <a href="https://millermedeiros.github.io/js-signals/"
                  >signals</a
                >, that can be used to react to changes in the ECS.
              </p>
              <p>
                The <code>world.attached</code> and
                <code>world.detached</code> signals are dispatched when
                components are attached to and deatched from an entity,
                respectively:
              </p>
              <pre style="background-color: #f6f8f8">
<code><span style="color:#555c64;">world.attached.subscribe((</span><span style="color:#8a6c3c;">entity</span><span style="color:#555c64;">, </span><span style="color:#8a6c3c;">component</span><span style="color:#555c64;">) </span><span style="color:#388282;">=&gt; </span><span style="color:#555c64;">{
  </span><span style="color:#8c95a0;">// component was attached last tick
</span><span style="color:#555c64;">})
world.detached.subscribe((</span><span style="color:#8a6c3c;">entity</span><span style="color:#555c64;">, </span><span style="color:#8a6c3c;">component</span><span style="color:#555c64;">) </span><span style="color:#388282;">=&gt; </span><span style="color:#555c64;">{
  </span><span style="color:#8c95a0;">// component was detached last tick
</span><span style="color:#555c64;">})
</span></code></pre>
              <p>
                <code>world.spawned</code> is dispatched when an entity is
                created:
              </p>
              <pre style="background-color: #f6f8f8">
<code><span style="color:#555c64;">world.spawned.subscribe(</span><span style="color:#8a6c3c;">entity </span><span style="color:#388282;">=&gt; </span><span style="color:#555c64;">{
  </span><span style="color:#8c95a0;">// entity was created last tick
</span><span style="color:#555c64;">})
</span></code></pre>
              <p>
                <code>world.destroyed</code> is dispatched when an entity is
                destroyed:
              </p>
              <pre style="background-color: #f6f8f8">
<code><span style="color:#555c64;">world.destroyed.subscribe(</span><span style="color:#8a6c3c;">entity </span><span style="color:#388282;">=&gt; </span><span style="color:#555c64;">{
  </span><span style="color:#8c95a0;">// entity was destroyed last tick
</span><span style="color:#555c64;">})
</span></code></pre>
              <p>
                A function is returned from <code>signal.subscribe()</code> that
                can be used to remove the subscriber.
              </p>
              <pre style="background-color: #f6f8f8">
<code><span style="color:#388282;">const </span><span style="color:#555c64;">unsubscribe </span><span style="color:#388282;">= </span><span style="color:#555c64;">world.attached.subscribe(</span><span style="color:#388282;">...</span><span style="color:#555c64;">)
unsubscribe()
</span></code></pre>
              <h2 id="triggers">
                Triggers<a
                  class="zola-anchor"
                  href="#triggers"
                  aria-label="Anchor link for: triggers"
                  >#</a
                >
              </h2>
              <p>
                Subscribing to events within systems is tricky since a system is
                just a function that runs each tick. Javelin has a couple of
                built-in effects called <strong>triggers</strong> that register
                event handlers behind the scenes, exposing changed entitites
                with an iterable API.
              </p>
              <h3 id="effattach">
                <code>effAttach</code
                ><a
                  class="zola-anchor"
                  href="#effattach"
                  aria-label="Anchor link for: effattach"
                  >#</a
                >
              </h3>
              <p>
                The <code>effAttach</code> trigger accepts a component type and
                returns an object that can be iterated with
                <code>for..of</code> or <code>forEach</code> to get
                entity-component pairs where the component of the specified type
                was detached last tick.
              </p>
              <pre style="background-color: #f6f8f8">
<code><span style="color:#388282;">import </span><span style="color:#555c64;">{ effAttach } </span><span style="color:#388282;">from </span><span style="color:#4179ad;">&quot;@javelin/ecs&quot;

</span><span style="color:#388282;">const </span><span style="color:#555c64;">sysPhysics </span><span style="color:#388282;">= </span><span style="color:#555c64;">() </span><span style="color:#388282;">=&gt; </span><span style="color:#555c64;">{
  effAttach(Body).forEach((</span><span style="color:#8a6c3c;">entity</span><span style="color:#555c64;">, </span><span style="color:#8a6c3c;">body</span><span style="color:#555c64;">) </span><span style="color:#388282;">=&gt; </span><span style="color:#555c64;">{
    </span><span style="color:#388282;">...
  </span><span style="color:#555c64;">})
}
</span></code></pre>
              <h3 id="effdetach">
                <code>effDetach</code
                ><a
                  class="zola-anchor"
                  href="#effdetach"
                  aria-label="Anchor link for: effdetach"
                  >#</a
                >
              </h3>
              <p>
                <code>effDetach</code> is similar to <code>effAttach</code>, but
                it returns entity-component pairs whose matching component was
                detached last tick.
              </p>
              <pre style="background-color: #f6f8f8">
<code><span style="color:#388282;">import </span><span style="color:#555c64;">{ effDetach } </span><span style="color:#388282;">from </span><span style="color:#4179ad;">&quot;@javelin/ecs&quot;

</span><span style="color:#388282;">const </span><span style="color:#555c64;">sysPhysics </span><span style="color:#388282;">= </span><span style="color:#555c64;">(</span><span style="color:#8a6c3c;">world</span><span style="color:#388282;">: </span><span style="color:#555c64;">World) </span><span style="color:#388282;">=&gt; </span><span style="color:#555c64;">{
  effDetach(Body).forEach((</span><span style="color:#8a6c3c;">entity</span><span style="color:#555c64;">, </span><span style="color:#8a6c3c;">body</span><span style="color:#555c64;">) </span><span style="color:#388282;">=&gt; ...</span><span style="color:#555c64;">)
}
</span></code></pre>
              <h2 id="monitors">
                Monitors<a
                  class="zola-anchor"
                  href="#monitors"
                  aria-label="Anchor link for: monitors"
                  >#</a
                >
              </h2>
              <p>
                Sometimes you need to go a bit further and detect when an entity
                matches or no longer matches a complex query. A
                <strong>monitor</strong> is an effect that accepts a query and
                yields entities that meet one of these conditions. Like
                triggers, monitors can be iterated with <code>forEach</code> or
                <code>for..of</code>.
              </p>
              <p>
                An entity is only included in a monitor's results
                <strong>once</strong> while it continues to match the query. An
                entity is eligible again only if it is excluded (i.e. due to a
                change in its type) and re-included.
              </p>
              <h3 id="effinsert">
                <code>effInsert</code
                ><a
                  class="zola-anchor"
                  href="#effinsert"
                  aria-label="Anchor link for: effinsert"
                  >#</a
                >
              </h3>
              <p>
                The <code>effInsert</code> monitor yields entities who will
                match a specific query for the first time this tick.
              </p>
              <pre style="background-color: #f6f8f8">
<code><span style="color:#388282;">const </span><span style="color:#555c64;">spooky </span><span style="color:#388282;">= </span><span style="color:#555c64;">createQuery(Enemy, Ghost)
effInsert(spooky).forEach(</span><span style="color:#8a6c3c;">entity </span><span style="color:#388282;">=&gt; ...</span><span style="color:#555c64;">)
</span></code></pre>
              <p>
                <code>forEach</code> executes the provided callback for entities
                whose component changes last tick caused it to match the query's
                criteria. In the above example, the <code>entity</code> variable
                would correspond to an entity who made one of the following type
                transitions last tick:
              </p>
              <pre style="background-color: #f6f8f8">
<code><span style="color:#555c64;">from    | to
--------|----------------
()      | (Enemy, Ghost)
(Enemy) | (Enemy, Ghost)
(Ghost) | (Enemy, Ghost)
</span></code></pre>
              <p>
                Below is an example of an entity transitioning between multiple
                types, and whether or not that transition would result in the
                entity being included in <code>effInsert</code>'s results:
              </p>
              <pre style="background-color: #f6f8f8">
<code><span style="color:#555c64;">(Enemy)                  -&gt; excluded
(Enemy, Ghost)           -&gt; included
(Enemy, Ghost, Confused) -&gt; excluded
(Ghost, Confused)        -&gt; excluded
(Enemy, Ghost)           -&gt; included
</span></code></pre>
              <h3 id="effremove">
                <code>effRemove</code
                ><a
                  class="zola-anchor"
                  href="#effremove"
                  aria-label="Anchor link for: effremove"
                  >#</a
                >
              </h3>
              <p>
                <code>effRemove</code> is simply the inverse of
                <code>effInsert</code>. It will yield entities whose type no
                longer matches the query's criteria.
              </p>
              <pre style="background-color: #f6f8f8">
<code><span style="color:#555c64;">effRemove(spooky).forEach(</span><span style="color:#8a6c3c;">entity </span><span style="color:#388282;">=&gt; ...</span><span style="color:#555c64;">)
</span></code></pre>
              <pre style="background-color: #f6f8f8">
<code><span style="color:#555c64;">(Enemy)                  -&gt; excluded
(Enemy, Ghost)           -&gt; excluded
(Enemy, Ghost, Confused) -&gt; excluded
(Ghost, Confused)        -&gt; included
(Enemy, Ghost)           -&gt; excluded
</span></code></pre>
            </div>
          </div>
        </div>
      </section>
    </main>
  </body>
</html>
