!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).JavelinEffects={})}(this,(function(e){"use strict";var t;!function(e){e[e.Orphaned=0]="Orphaned",e[e.Attaching=1]="Attaching",e[e.Attached=2]="Attached",e[e.Detaching=3]="Detaching",e[e.Detached=4]="Detached"}(t||(t={}));const o={__WORLDS__:[],__CURRENT_WORLD__:-1};function n(e,t={throw:!1,global:!1}){const{global:n}=t,r=[];let l,c,s,a,i,u=-1;return function(...t){a=o.__CURRENT_WORLD__;const p=o.__WORLDS__[a],h=p.state.currentTick;i=n?0:p.state.currentSystem;let f=r[a];void 0===r[a]&&(f=r[a]=[]);let y=f[i];if(void 0===y&&(y=f[i]={cells:[],cellCount:-1}),!0===n||c!==a&&void 0!==c)u=0;else if(void 0===s||l===h&&s===i)u++;else{let e=f[s];if(-1!==e.cellCount&&e.cellCount!==u)throw new Error(`Failed to execute effect: encountered too ${e.cellCount>u?"few":"many"} hooks this tick`);e.cellCount=u,u=0}let d=y.cells[u];if(d||(d=y.cells[u]={executor:e(p),lockGlobal:!1,lockAsync:!1,lockGlobalTick:-1,state:null}),n&&(d.lockGlobalTick!==p.state.currentTick?(d.lockGlobal=!1,d.lockGlobalTick=p.state.currentTick):d.lockGlobal=!0),d.lockGlobal||d.lockAsync)return d.state;const A=d.executor(...t);var _;return"object"==typeof(_=A)&&null!==_&&"then"in _?(d.lockAsync=!0,A.then(e=>d.state=e).catch(e=>console.error("Uncaught error in effect: "+e.message,e)).then(()=>d.lockAsync=!1)):d.state=A,l=h,c=a,s=i,d.state}}var r;!function(e){e[e.Push=0]="Push",e[e.Pop=1]="Pop",e[e.Shift=2]="Shift",e[e.Unshift=3]="Unshift",e[e.Splice=4]="Splice"}(r||(r={}));new Map([[Array.prototype.push,r.Push],[Array.prototype.pop,r.Pop],[Array.prototype.shift,r.Shift],[Array.prototype.unshift,r.Unshift],[Array.prototype.splice,r.Splice]]),new Map([[r.Push,Array.prototype.push],[r.Pop,Array.prototype.pop],[r.Shift,Array.prototype.shift],[r.Unshift,Array.prototype.unshift],[r.Splice,Array.prototype.splice]]);var l;!function(e){e[e.Spawn=0]="Spawn",e[e.Attach=1]="Attach",e[e.Detach=2]="Detach",e[e.Mutate=3]="Mutate",e[e.Destroy=4]="Destroy"}(l||(l={}));const c=n(()=>{let e=!0;const t={value:null};return o=>(e&&(t.value=o,e=!1),t)}),s=n(()=>{let e,t=0;return(o,n=!1)=>(n&&(t=0,clearTimeout(e)),0===t&&(t=1,e=setTimeout(()=>{t=2},o)),2===t)}),a=n(()=>e=>{const t=c(!1),o=s(e,t.value);return t.value=o,o}),i=n(()=>{let e,t={response:null,error:null,done:!1},o=!1,n=new window.AbortController;return(r,l,c=void 0!==e&&r!==e)=>(c&&(t={response:t.response,error:null,done:!1},n.abort(),n=new AbortController),t.done||null===r||o||(o=!0,e=r,fetch(r,{...l,signal:n.signal}).then(e=>{t={response:e,error:null,done:!0}}).catch(e=>{t={response:t.response,error:e,done:!0}}).then(()=>{o=!1})),t)}),u=n(()=>(...e)=>{const t=i(...e);return t.response?t.response.json().then(e=>({...t,response:e})):t});e.interval=a,e.json=u,e.ref=c,e.request=i,e.timer=s,Object.defineProperty(e,"__esModule",{value:!0})}));
